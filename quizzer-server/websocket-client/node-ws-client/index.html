<html>
<head>
    <title></title>
    <style>
    </style>
</head>
<body>
<h1>Connect to the random number server!</h1>
<hr>
<form id="messageForm">
    <label for="teamNameField">team name:</label><input id="teamNameField" type="text" value="Team 1" autofocus><br>
    <label for="quizNameField">quiz code:</label><input id="quizNameField" type="text" value="qhhhnt"><br>
    <button id="sendMessageButton">Send Message!</button>
</form>
<hr>
<h3>messages:</h3>
<ul id="messageList">
</ul>
<hr>

</body>
<script >


    let initWebsocket = () => {
        let wsConnection = new WebSocket('ws://localhost:3000');

        wsConnection.onopen = function(arg) {
            //TODO Complete this event handler
            console.log(" Client heeft connectie ");
        };

        wsConnection.onmessage = function(arg){
            console.log(" nu zou je opnieuw moeten http requesten naar een of ander endpoint ");
            let message = JSON.parse(arg.data);
            console.log(message);
            addMessageItem(message.message);
        };

        wsConnection.onclose = function(arg){
            console.log(" Connectie wordt nu gesloten ");
            wsConnection.close();
            wsConnection = null;
        };

        /**
         * Function for handling form submissions
         */
        document.getElementById("messageForm").addEventListener( "submit", function(eventInfo) {
            eventInfo.preventDefault();
            console.log("SUBMIT FORM");
            sendData();
        });


        function sendData() {
            var dataObject = {
                teamName: document.getElementById("teamNameField").value,
                quizCode: document.getElementById("quizNameField").value
            };

            let jsonStr = JSON.stringify(dataObject);
            wsConnection.send(jsonStr);
            console.log("SENT DATA:", jsonStr );
        }

        function addMessageItem(text) {
            var el = document.createElement("li");
            el.innerHTML = text;
            document.getElementById("messageList").appendChild(el);
        }

        return wsConnection;
    };
    asdf = () => {
        fetch('http://localhost:3000/quizzes/qhhhnt/teams',{
            method: "POST",
            credentials: "include",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({"teamName": "sfgrth124235645123463546123478"})
        }).then((result) => {let wsConnection = initWebsocket()});

        //console.log(result);
    };
    asdf();




</script>
</html>